(title "match <string>")

(expect:error
    "\(match\) reference expected to be string or regex name"
    (fn (shield:validate null (shield:model (rules match true ))))
    "match invalid reference type"
)

(expect:error
    "\(match\) undefined regex: my_regex"
    (fn (shield:validate null (shield:model (rules match "my_regex" ))))
    "match invalid regex"
)

(expect:eq
    {"0" "Nice"}
    (shield:validate "hello Nice world" (shield:model (rules match "/nice/i" )))
    "match using inline regex"
)

(expect:eq
    {"0" "2026"}
    (shield:validate "this is 2026 year" (shield:model (rules match "number" )))
    "match using named regex"
)

(expect:eq
    {"0" "1"}
    (shield:validate true (shield:model (rules match "number" )))
    "match using named regex from non-string"
)

(expect:eq
    {"0" "Sunday 11th Jan of 2026" "1" "Sunday" "2" "11" "3" "Jan" "4" "2026"}
    (shield:validate "today is Sunday 11th Jan of 2026" (shield:model (rules match `/(monday|sunday)\s*(\d+).*(Jan|Mar|Dec)[^\d]+(\d+)/i` )))
    "match using inline regex with captures"
)

(expect:eq
    {"0" "Sunday 11th Jan of 2026" "weekday" "Sunday" "1" "Sunday" "day" "11" "2" "11" "month" "Jan" "3" "Jan" "year" "2026" "4" "2026"}
    (shield:validate "today is Sunday 11th Jan of 2026" (shield:model (rules match `/(?<weekday>monday|sunday)\s*(?<day>\d+).*(?<month>Jan|Mar|Dec)[^\d]+(?<year>\d+)/i` )))
    "match using inline regex with named captures"
)

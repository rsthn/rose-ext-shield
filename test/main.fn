
(include "utils")
(include "test-data")

;; -----
(title "Wrong root type")
(expect:error   "@messages.expect:obj"      (fn (shield:validate (null) (shield:model (object *)))))
(expect:error   "@messages.expect:obj"      (fn (shield:validate (null) (shield:model (obj *)))))
(expect:error   "@messages.expect:array"    (fn (shield:validate (null) (shield:model (array *)))))
(expect:error   "@messages.expect:vector"   (fn (shield:validate (null) (shield:model (vector *)))))
(expect:error   "@messages.expect:bool"     (fn (shield:validate (null) (shield:model (boolean)))))
(expect:error   "@messages.expect:bool"     (fn (shield:validate (null) (shield:model (bool)))))
(expect:error   "@messages.expect:int"      (fn (shield:validate (null) (shield:model (integer)))))
(expect:error   "@messages.expect:int"      (fn (shield:validate (null) (shield:model (int)))))
(expect:error   "@messages.expect:float"    (fn (shield:validate (null) (shield:model (float)))))
(expect:error   "@messages.expect:str"      (fn (shield:validate (null) (shield:model (string)))))
(expect:error   "@messages.expect:str"      (fn (shield:validate (null) (shield:model (str)))))
(expect:error   "@messages.expect:null"     (fn (shield:validate ('xx') (shield:model (null)))))

;; -----
(title "Correct root type")
(expect:eq   (data_obj)     (shield:validate (data_obj) (shield:model (object *))))
(expect:eq   (data_obj)     (shield:validate (data_obj) (shield:model (obj *))))
(expect:eq   (data_array)   (shield:validate (data_array) (shield:model (array *))))
(expect:eq   (data_array)   (shield:validate (data_array) (shield:model (array (int)))))
(expect:eq   (data_vector)  (shield:validate (data_vector) (shield:model (vector * * *))))
(expect:eq   (data_vector)  (shield:validate (data_vector) (shield:model (vector (str) (bool) (int)))))
(expect:eq   (data_bool)    (shield:validate (data_bool) (shield:model (boolean))))
(expect:eq   (data_bool)    (shield:validate (data_bool) (shield:model (bool))))
(expect:eq   (data_int)     (shield:validate (data_int) (shield:model (integer))))
(expect:eq   (data_int)     (shield:validate (data_int) (shield:model (int))))
(expect:eq   (data_float)   (shield:validate (data_float) (shield:model (float))))
(expect:eq   (data_str)     (shield:validate (data_str) (shield:model (string))))
(expect:eq   (data_str)     (shield:validate (data_str) (shield:model (str))))
(expect:eq   (data_null)    (shield:validate (data_null) (shield:model (null))))

;; -----
(include "test_basic")
(echo)

(include "use")
(include "check")
(include "ignore")
(include "cast")
(include "required")
(include "presence")
(include "requires")
(include "default")
(include "default-stop")
(include "enum")
(include "fail")
(include "length")
(include "expect")
(include "min-length")
(include "max-length")
(include "min-value")
(include "max-value")
(include "min-items")
(include "max-items")
(include "unique-items")
(include "stop")
(include "extract")
(include "match")
(include "pattern")
(include "not-matches")
(include "case")

(echo)
(include "test_combined")

(title-end)
(echo)
(when (failed)
    (throw "(failed) tests were not successful"))

;pending:
; FileType
; MaxFileSize

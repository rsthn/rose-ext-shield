
(include "utils")
(include "test-data")

;; -----
(title "Wrong root type")
(expect:error
    "@messages.expect:obj"
    (fn (shield:validate (null) (shield:model (object *))))
    "wrong type for object"
)
(expect:error
    "@messages.expect:obj"
    (fn (shield:validate (null) (shield:model (obj *))))
    "wrong type for obj"
)
(expect:error
    "@messages.expect:array"
    (fn (shield:validate (null) (shield:model (array *))))
    "wrong type for array"
)
(expect:error
    "@messages.expect:vector"
    (fn (shield:validate (null) (shield:model (vector *))))
    "wrong type for vector"
)

;; -----
(title "Correct root type")
(expect:eq   (data_obj)     (shield:validate (data_obj) (shield:model (object *))))
(expect:eq   (data_obj)     (shield:validate (data_obj) (shield:model (obj *))))
(expect:eq   (data_array)   (shield:validate (data_array) (shield:model (array *))))
(expect:eq   (data_array)   (shield:validate (data_array) (shield:model (array (int)))))
(expect:eq   (data_vector)  (shield:validate (data_vector) (shield:model (vector * * *))))
(expect:eq   (data_vector)  (shield:validate (data_vector) (shield:model (vector (str) (bool) (int)))))

;; -----
(include "test_basic")
(echo)

(include "use")
(include "check")
(include "ignore")
(include "cast")
(include "required")
(include "presence")
(include "requires")
(include "default")
(include "default-stop")
(include "enum")
(include "fail")
(include "length")
(include "expect")
(include "min-length")
(include "max-length")
(include "min-value")
(include "max-value")
(include "min-items")
(include "max-items")
(include "unique-items")
(include "stop")
(include "extract")
(include "match")
(include "pattern")
(include "not-matches")
(include "matches")
(include "case")

(echo)
(include "test_combined")

(title-end)
(echo)
(when (failed)
    (throw "(failed) tests were not successful"))

;pending:
; FileType
; MaxFileSize

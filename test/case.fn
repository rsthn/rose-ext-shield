(title "case-when <condition>")

(expect:eq
    "found_hello"
    (shield:validate "hello world" (shield:ruleset __inline__
        case-when (in? ($) "hello")
            set "found_hello"
        case-end
    ))
    "case-when single"
)

(expect:eq
    "FOUND_BYE"
    (shield:validate "bye world" (shield:ruleset __inline__
        case-when (in? ($) "hello")
            set "found_hello"
        case-when (in? ($) "bye")
            set "found_bye"
        case-end
        set (upper ($))
    ))
    "case-when multiple"
)

(expect:eq
    "none"
    (shield:validate "good world" (shield:ruleset __inline__
        case-when (in? ($) "hello")
            set "found_hello"
        case-when (in? ($) "bye")
            set "found_bye"
        case-else
            set "none"
        case-end
    ))
    "case-when multiple with case-else"
)

;; todo: nested case-when not supported
